dataSources:
  ds_0:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    jdbcUrl: jdbc:mysql://192.168.116.101:3306/damai_order_0?useUnicode=true&characterEncoding=UTF-8&rewriteBatchedStatements=true&allowMultiQueries=true&serverTimezone=Asia/Shanghai&autoReconnect=true
    username: root
    password: root
    hikari:
      max-lifetime: 60000
  ds_1:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    jdbcUrl: jdbc:mysql://192.168.116.101:3306/damai_order_1?useUnicode=true&characterEncoding=UTF-8&rewriteBatchedStatements=true&allowMultiQueries=true&serverTimezone=Asia/Shanghai&autoReconnect=true
    username: root
    password: root
    hikari:
      max-lifetime: 60000

rules:
  - !SHARDING
    tables:
      # 对 d_order 表进行分库分表
      d_order:
        # damai_order 分为两个库，每个库中有四个 d_order 表
        actualDataNodes: ds_${0..1}.d_order_${0..3}
        # 分库策略
        databaseStrategy:
          complex:
            # 使用 order_number，user_id 作为分片键
            shardingColumns: order_number,user_id
            # 使用 order_number，user_id 分库算法
            shardingAlgorithmName: databaseOrderComplexGeneArithmetic
        # 分表策略
        tableStrategy:
          complex:
            # 使用 order_number，user_id 作为分片键
            shardingColumns: order_number,user_id
            # 使用 order_number，user_id 分表算法
            shardingAlgorithmName: tableOrderComplexGeneArithmetic
      # 对 d_order_ticket_user 表进行分库分表
      d_order_ticket_user:
        # damai_order_ticket_user 分为两个库，每个库中有四个 d_order_ticket_user 表
        actualDataNodes: ds_${0..1}.d_order_ticket_user_${0..3}
        # 分库策略
        databaseStrategy:
          complex:
            # 使用 order_number，user_id 作为分片键
            shardingColumns: order_number,user_id
            # 使用 order_number，user_id 分库算法
            shardingAlgorithmName: databaseOrderTicketUserComplexGeneArithmetic
        # 分表策略
        tableStrategy:
          complex:
            # 使用 order_number，user_id 作为分片键
            shardingColumns: order_number,user_id
            # 使用 order_number，user_id 分表算法
            shardingAlgorithmName: tableOrderTicketUserComplexGeneArithmetic
    # 绑定表
    bindingTables:
      - d_order,d_order_ticket_user
    # 具体算法
    shardingAlgorithms:
      # d_order 表分库算法
      databaseOrderComplexGeneArithmetic:
        # 通过自定义实现类实现分库算法
        type: CLASS_BASED
        props:
          # 分库数量
          sharding-count: 2
          # 分表数量
          table-sharding-count: 4
          # 分库策略，复合多切片
          strategy: complex
          # 具体的分库逻辑在此自定义类中
          algorithmClassName: com.damai.shardingsphere.DatabaseOrderComplexGeneArithmetic
      # d_order 表分表算法
      tableOrderComplexGeneArithmetic:
        # 通过自定义实现类实现分表算法
        type: CLASS_BASED
        props:
          # 分表数量
          sharding-count: 4
          # 分库策略，复合多切片
          strategy: complex
          # 具体的分表逻辑在此自定义类中
          algorithmClassName: com.damai.shardingsphere.TableOrderComplexGeneArithmetic
      databaseOrderTicketUserComplexGeneArithmetic:
        type: CLASS_BASED
        props:
          sharding-count: 2
          table-sharding-count: 4
          strategy: complex
          algorithmClassName: com.damai.shardingsphere.DatabaseOrderComplexGeneArithmetic
      tableOrderTicketUserComplexGeneArithmetic:
        type: CLASS_BASED
        props:
          sharding-count: 4
          strategy: complex
          algorithmClassName: com.damai.shardingsphere.TableOrderComplexGeneArithmetic
props:
  sql-show: true